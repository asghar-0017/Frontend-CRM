import{r as o,f as O,u as R,j as t}from"./index-C05QhGEP.js";import{b as T}from"./apiServices-BLiMT9Yd.js";import{A as M}from"./AssignTaskByCSV-eiEs8NSI.js";import{I as E}from"./index-By0aXpWG.js";import{a as B}from"./index-DkSBVQII.js";import{S as P,T as V,R as z}from"./TaskList-B4mygb29.js";import{l as F}from"./index-CGwCSIWv.js";import{A as _}from"./api-CigzIjai.js";import{B as $}from"./Button-D9YPwSqa.js";import"./axios-B4uVmeYG.js";import"./Socket-BAmX9CkN.js";import"./iconBase-DrVbEGxc.js";import"./sweetalert2.all-I3mqL4O0.js";import"./List-Tf7OrP3l.js";import"./Serializer-D5ddTVbr.js";import"./DefaultPropsProvider-CK6xLYnL.js";import"./generateUtilityClasses-C5UaBTEU.js";import"./createBox-DKObizbn.js";import"./useSlotProps-C1ZMSFiR.js";import"./TextField-CqwtIWC_.js";import"./createSvgIcon-DJsEsuGB.js";import"./Drawer-B1GF-AHl.js";import"./assertThisInitialized-C91vtUtA.js";const pe=()=>{const[c,d]=o.useState([]),[j,k]=o.useState(""),{id:a}=O(),p=window.localStorage.getItem("token"),m=R(),[u,f]=o.useState(!1),[C,x]=o.useState(!1),r=o.useRef(null),{apiKey:g}=_,w=()=>{f(!0)},y=()=>{f(!1)},S=e=>{k(e),x(!0)},I=()=>{x(!1)},v=localStorage.getItem("agentId");o.useEffect(()=>(r.current||(r.current=F(g),r.current.on("receive_message",e=>{!e.message&&e.data.agentId==v&&(console.log(e.data),d(s=>{const n=[...s];return e.forEach(l=>{const h=n.findIndex(N=>N.id===l.id);h===-1?n.push(l):n[h]=l}),n}))}),r.current.on("connect_error",e=>{console.error("WebSocket connection error:",e)})),()=>{r.current&&(r.current.disconnect(),r.current=null)}),[g]),o.useEffect(()=>{(async()=>{try{const s=await T("get-assign-tasks",p,a);d(s)}catch(s){console.error("Error fetching data:",s)}})()},[a,p]);const i=o.useMemo(()=>c.reduce((e,s)=>(e[s.taskNo]||(e[s.taskNo]={tasks:[],status:new Set}),e[s.taskNo].tasks.push(s),e[s.taskNo].status.add(s.status),e),{}),[c]),D=e=>{m(`/tasksCSV/${a}/${e}`)},b={progress:"#FFC107",complete:"#03C04A"},A=e=>{const s=Array.from(e)[0];return b[s]};return t.jsxs("div",{style:{width:"100%",height:"100%",padding:"30px"},children:[t.jsxs("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs("div",{style:{display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"center"},children:[t.jsx(E,{size:20,onClick:()=>m(-1),style:{cursor:"pointer",marginRight:"10px"}}),t.jsx("span",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#1640D6"},children:"All Tasks:"})]}),t.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[t.jsx(P,{}),t.jsx($,{variant:"contained",className:"form-btn addNew",onClick:w,style:{backgroundColor:"#1640D6"},children:"Upload CSV"}),t.jsx(M,{open:u,onClose:y,endpointCSV:"upload-task"},u.toString())]})]}),t.jsx("br",{}),t.jsx("br",{}),t.jsx("div",{className:"task-list",children:Object.keys(i).map(e=>t.jsxs("div",{className:"task-item",style:{backgroundColor:A(i[e].status)},children:[t.jsx("span",{className:"task-number",onClick:()=>D(e),children:`Task No: ${e}`}),Array.from(i[e].status)[0]==="complete"&&t.jsx(V,{title:"Assign Review",PopperProps:{sx:{"& .MuiTooltip-tooltip":{marginTop:"25px"}}},children:t.jsx("span",{onClick:()=>S(e),className:"review-icon",children:t.jsx(B,{color:"white",size:25,style:{cursor:"pointer"}})})})]},e))}),t.jsx(z,{open:C,onClose:I,taskNo:j})]})};export{pe as default};
